

<!DOCTYPE html>
<head>
<meta charset="utf-8">
<title>Multi Line Chart</title>
<script type="text/javascript" src="https://d3js.org/d3.v4.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<style>
    /* AXES */
    /* ticks */
    .axis line{
    stroke: #706f6f;
    stroke-width: 0.5;
    shape-rendering: crispEdges;
    }
    
    /* axis contour */
    .axis path {
    stroke: #706f6f;
    stroke-width: 0.7;
    shape-rendering: crispEdges;
    }
    
    /* axis text */
    .axis text {
    fill: #2b2929;
    font-family: Georgia;
    font-size: 120%;
    }
    
    /* LINE CHART */
    path.line-0 {
    fill: none;
    stroke: #ed3700;
    }
    
    .dot-0 {
    fill: #fa0101;
    stroke: #fff;
}
    
    .line {
    fill: none;
    stroke: #0884e9;
    stroke-width: 2;
}
    
    .dot {
    fill: steelblue;
    stroke: #fff;
}</style>
</head>
<body>
    <p style="text-align: center;"><span style="color: #006666; font-size: 30px; font-family: Verdana">Netflix Growth Analysis</span></p>
    <p style="text-align: center;"><span style="color: #009999; font-size: 26px; font-family: Verdana">Total Amount of Content Added by a Given Country in a Given Year</span></p>   
    
<h3 style="text-align: left;">About Netflix</h3>
<p>This chart shows content growth over the years for different country.In 2010 	Netflix starts expanding its streaming service to the international market, starting with Canada.
</p>
<p>information Source https://en.wikipedia.org/wiki/Timeline_of_Netflix</p>
<select id="selectButton"></select>

<div id="nextpage" style="text-align: right;">
    <a href="index.html">
        <button> Back to First Slide</button>
    </a>
    </div>
    <div id="container" class="svg-container"></div>
    <script>
    //------------------------1. PREPARATION------------------------//
//-----------------------------SVG------------------------------//
var margin = {top: 10, right: 50, bottom: 100, left: 125};
    var width=900;
  var height=400;
// we are appending SVG first

var svg = d3.select("div#container").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");


//Read the data
d3.csv("https://raw.githubusercontent.com/mdemuri2/CS416DataVisualization/master/scene_3.csv", function(data) {

// List of groups (here I have one group per column)
var allGroup = d3.map(data, function(d){return(d.country)}).keys()
console.log(allGroup)
// add the options to the button
d3.select("#selectButton")
  .selectAll('myOptions')
     .data(allGroup)
  .enter()
    .append('option')
  .text(function (d) { return d; }) // text showed in the menu
  .attr("value", function (d) { return d; }) // corresponding value returned by the button

// Add X axis --> it is a date format
var x = d3.scaleLinear()
  .domain(d3.extent(data, function(d) { return d.year_added;}))
  .range([ 0, width ]);
svg.append("g")
  .attr("transform", "translate(0," + height + ")")
 // .call(d3.axisBottom(x));

var parseTime = d3.timeParse("%Y");
 var x_2 = d3.scaleTime()
  .domain(d3.extent(data, function(d) { return parseTime(d.year_added); }))
  .range([ 0, width ]);
svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x_2));

// Add Y axis
var y = d3.scaleLinear()
  .domain([0, d3.max(data, function(d) { return +d.total_count; }) + 100])
  .range([ height, 0 ]);
svg.append("g")
  .call(d3.axisLeft(y));


// Maria START

// This allows to find the closest X index of the mouse:
var bisect = d3.bisector(function(d) { return d.year_added; }).left

// Create the circle that travels along the curve of chart
var focus = svg
  .append('g')
  .append('circle')
    .style("fill", "none")
    .attr("stroke", "black")
    .attr('r', 8.5)
    .style("opacity", 0)

// Create the text that travels along the curve of chart
var focusText = svg
  .append('g')
  .append('text')
    .style("opacity", 1)
    .style("fill", "black")
    .style("font-size", "0.8em")
    .attr("text-anchor", "left")
    .attr("alignment-baseline", "middle")
// MARIA END

//-----------------------------Anotation-----------------------------//
// Initialize the first annotation
// Features of the annotation
const annotations = [
  {
    note: {
      label: "The US is Netflixâ€™s first and largest market. Again, 2015 appears to be an elbow point in the graph, marking the beginning of when Netflix added a lot of American produced content to their platform ",
      title: "2015",
      align: "middle",  // try right or left
      wrap: 200,  // try something smaller to see text split in several lines
      padding: 10   // More = text lower
    },
    color: ["#69b3a2"],
    x: 560,
    y: 350,
    dy: -120,
    dx: -50
  }
]

// Add annotation to the chart
const makeAnnotations = d3.annotation()
  .annotations(annotations)
svg.append("g")
.style("font-family", "Verdana")
.style("font-size", "11px")
  .call(makeAnnotations)

//-----------------------------Anotation-----------------------------//



// Initialize line with first group of the list
var line = svg
  .append('g')
  .append("path")
    .datum(data.filter(function(d){return d.country==allGroup[0]}))
    .attr("d", d3.line()
      .x(function(d) { return x(d.year_added) })
      .y(function(d) { return y(+d.total_count) })
    )
    .attr("stroke", "steelblue" )
    .style("stroke-width", 2)
    .style("opacity", 0.8)
    .style("fill", "none")

 // MARIA START
 // Create a rect on top of the svg area: this rectangle recovers mouse position
  svg
  .append('rect')
  .style("fill", "none")
  .style("pointer-events", "all")
  .attr('width', width)
  .attr('height', height)
  .on('mouseover', mouseover)
  .on('mousemove', mousemove)
  .on('mouseout', mouseout);


// What happens when the mouse move -> show the annotations at the right positions.
function mouseover() {
  focus.style("opacity", 1)
  focusText.style("opacity",1)
}

function mousemove() {
  // recover coordinate we need
  var x0 = x.invert(d3.mouse(this)[0]);
  var i = bisect(data.filter(function(d){return d.country==allGroup[0]}), x0, 1);
  selectedData = data.filter(function(d){return d.country==allGroup[0]})[i]
  focus
    .attr("cx", x(selectedData.year_added))
    .attr("cy", y(selectedData.total_count))
  focusText
    .html("x = " + Math.round(selectedData.year_added) + ",  " + "y = " + selectedData.total_count)
    .attr("x", x(selectedData.year_added)-50)
    .attr("y", y(selectedData.total_count)-20)
  }

function mouseout() {
  focus.style("opacity", 0)
  focusText.style("opacity", 0)
}
// MARIA END


// A function that update the chart
function update(selectedGroup) {

    function mousemove() {
    // recover coordinate we need
    var x0 = x.invert(d3.mouse(this)[0]);
    var i = bisect(data.filter(function(d){return d.country==selectedGroup}), x0, 1);
    selectedData = data.filter(function(d){return d.country==selectedGroup})[i]
    focus
      .attr("cx", x(selectedData.year_added))
      .attr("cy", y(selectedData.total_count))
    focusText
      .html("x = " + Math.round(selectedData.year_added) + ",  " + "y = " + selectedData.total_count)
      .attr("x", x(selectedData.year_added)-50)
      .attr("y", y(selectedData.total_count)-20)
    }

  // Create new data with the selection?
  var dataFilter = data.filter(function(d){return d.country==selectedGroup})

  // Give these new data to update line
  line
      .datum(dataFilter)
      .transition()
      .duration(1000)
      .attr("d", d3.line()
        .x(function(d) { return x(d.year_added) })
        .y(function(d) { return y(+d.total_count) })
      )
      .attr("stroke", "steelblue")

  // update tool-tip
  svg.selectAll("rect").remove()
  svg.append('rect')
    .style("fill", "none")
    .style("pointer-events", "all")
    .attr('width', width)
    .attr('height', height)
    .on('mouseover', mouseover)
    .on('mousemove', mousemove)
    .on('mouseout', mouseout);

  // remove inital annotation 
  svg.selectAll(".annotations").remove()

  if (selectedGroup == "United States") {
  const makeAnnotations = d3.annotation()
    .annotations(annotations)

    svg.append("g")
  .style("font-family", "Verdana")
  .style("font-size", "11px")
    .call(makeAnnotations)
  }
    
}

// When the button is changed, run the updateChart function
d3.select("#selectButton").on("change", function(d) {
    // recover the option that has been chosen
    var selectedOption = d3.select(this).property("value")
    // run the updateChart function with this selected option
    update(selectedOption)
})

//-----------------------------AXES LABELS-----------------------------//

svg.append("text")
    .attr("class","ant2")
    .attr("transform", "rotate(-90)")
    .attr("x", -322).attr("y", -230)
    .attr("dy","16em").text("Total Amount of Content Added in a Given Year")
    .style("font-size", "11.5px").style("font-family", "Verdana");
svg.append("g").selectAll(".ant2").attr("transform", "translate(180,350)")

svg.append("text")
    .attr("class","ant2")
    .attr("x", 435).attr("y", 255)
    .attr("dy","16em").text("Year")
    .style("font-size", "11.5px").style("font-family", "Verdana");
svg.append("g").selectAll(".ant2").attr("transform", "translate(180,350)")

})

</script>
</body>